<!doctype html>
<html>
  <% if(userId==1){%>
    <%- include('../partials/adminHeader') %>
  <%} else{%>
    <%- include('../partials/header') %>
  <%}%>
  
  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.rtlcss.com/bootstrap/v4.5.3/css/bootstrap.min.css" integrity="sha384-JvExCACAZcHNJEc7156QaHXTnQL3hQBixvj5RV5buE7vgnNEzzskDtx9NQ4p6BJe" crossorigin="anonymous">

    <!-- sweet alert -->
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.min.css'>    <!--Css link-->
    <!-- <link href="todoList.css" rel="stylesheet" type="text/css"> -->

  </head>
  
  <style>
    body{background-color: #3b3a3f; color:white !important; }.flex{-webkit-box-flex: 1;-ms-flex: 1 1 auto;flex: 1 1 auto}@media (max-width:991.98px){.padding{padding: 1.5rem}}@media (max-width:767.98px){.padding{padding: 1rem}}.padding{padding: 5rem}.card{box-shadow: none;-webkit-box-shadow: none;-moz-box-shadow: none;-ms-box-shadow: none}.pl-3, .px-3{padding-left: 1rem !important}.card{position: relative;display: flex;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border: 1px solid #d2d2dc;border-radius: 0}.pr-3, .px-3{padding-right: 1rem !important}.card .card-body{padding: 1.25rem 1.75rem}.card-body{flex: 1 1 auto;padding: 1.25rem}.card .card-title{color: white;margin-bottom: 0.625rem;text-transform: capitalize;font-size: 0.875rem;font-weight: 500}.add-items{margin-bottom: 1.5rem;overflow: hidden}.d-flex{display: flex !important}.add-items input[type="text"]{border-top-right-radius: 0;border-bottom-right-radius: 0;width: 100%;background: transparent}.form-control{border: 1px solid #f3f3f3;font-weight: 400;font-size: 0.875rem}.form-control{display: block;width: 100%;padding: 0.875rem 1.375rem;font-size: 1rem;line-height: 1;color: white;background-color: #ffffff;background-clip: padding-box;border: 1px solid #ced4da;border-radius: 2px;transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.add-items .btn{margin-left: .5rem}.btn{font-size: 0.875rem;line-height: 1;font-weight: 400;padding: .7rem 1.5rem;border-radius: 0.1275rem}.list-wrapper{height: 100%;max-height: 100%}.add-items{margin-bottom: 1.5rem;overflow: hidden}.add-items input[type="text"]{border-top-right-radius: 0;border-bottom-right-radius: 0;width: 100%;background: transparent}.add-items .btn, .add-items .fc button, .fc .add-items button, .add-items .ajax-upload-dragdrop .ajax-file-upload, .ajax-upload-dragdrop .add-items .ajax-file-upload, .add-items .swal2-modal .swal2-buttonswrapper .swal2-styled, .swal2-modal .swal2-buttonswrapper .add-items .swal2-styled, .add-items .wizard>.actions a, .wizard>.actions .add-items a{margin-left: .5rem}.rtl .add-items .btn, .rtl .add-items .fc button, .fc .rtl .add-items button, .rtl .add-items .ajax-upload-dragdrop .ajax-file-upload, .ajax-upload-dragdrop .rtl .add-items .ajax-file-upload, .rtl .add-items .swal2-modal .swal2-buttonswrapper .swal2-styled, .swal2-modal .swal2-buttonswrapper .rtl .add-items .swal2-styled, .rtl .add-items .wizard>.actions a, .wizard>.actions .rtl .add-items a{margin-left: auto;margin-right: .5rem}.list-wrapper{height: 100%;max-height: 100%}.list-wrapper ul{padding: 0;text-align: left;list-style: none;margin-bottom: 0}.list-wrapper ul li{font-size: .9375rem;padding: .4rem 0;border-bottom: 1px solid #f3f3f3}.list-wrapper ul li:first-child{border-bottom: none}.list-wrapper ul li .form-check{max-width: 90%;margin-top: .25rem;margin-bottom: .25rem}.list-wrapper ul li .form-check label:hover{cursor: pointer}.list-wrapper input[type="checkbox"]{margin-right: 15px}.list-wrapper .remove{cursor: pointer;font-size: 1.438rem;font-weight: 600;width: 1.25rem;height: 1.25rem;line-height: 20px;text-align: center}.list-wrapper .completed{text-decoration: line-through;text-decoration-color: white}.list-wrapper ul li .form-check{max-width: 90%;margin-top: .25rem;margin-bottom: .25rem}.list-wrapper ul li .form-check, .list-wrapper ul li .form-check .form-check-label, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-name, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-designation, .email-wrapper .mail-list-container .mail-list .content .sender-name, .email-wrapper .message-body .attachments-sections ul li .details p.file-name, .settings-panel .chat-list .list .info p{text-overflow: ellipsis;overflow: hidden;max-width: 100%;white-space: nowrap}.form-check{position: relative;display: block;margin-top: 10px;margin-bottom: 10px;padding-left: 0}.list-wrapper ul li .form-check, .list-wrapper ul li .form-check .form-check-label, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-name, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-designation, .email-wrapper .mail-list-container .mail-list .content .sender-name, .email-wrapper .message-body .attachments-sections ul li .details p.file-name, .settings-panel .chat-list .list .info p{text-overflow: ellipsis;overflow: hidden;max-width: 100%;white-space: nowrap}.form-check .form-check-label{min-height: 18px;display: block;margin-left: 1.75rem;font-size: 0.875rem;line-height: 1.5}.form-check-label{margin-bottom: 0}.list-wrapper input[type="checkbox"]{margin-right: 15px}.form-check .form-check-label input{position: absolute;top: 0;left: 0;margin-left: 0;margin-top: 0;z-index: 1;cursor: pointer;opacity: 0;filter: alpha(opacity=0)}input[type="radio"], input[type="checkbox"]{box-sizing: border-box;padding: 0}.list-wrapper ul li .form-check, .list-wrapper ul li .form-check .form-check-label, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-name, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user .u-designation, .email-wrapper .mail-list-container .mail-list .content .sender-name, .email-wrapper .message-body .attachments-sections ul li .details p.file-name, .settings-panel .chat-list .list .info p{text-overflow: ellipsis;overflow: hidden;max-width: 100%;white-space: nowrap}.form-check .form-check-label input[type="checkbox"]+.input-helper:before{content: "";width: 18px;height: 18px;border-radius: 2px;border: solid #891731;border-width: 2px;-webkit-transition: all;-moz-transition: all;-ms-transition: all;-o-transition: all;transition: all;transition-duration: 0s;-webkit-transition-duration: 250ms;transition-duration: 250ms}.form-check .form-check-label input[type="checkbox"]+.input-helper:before, .form-check .form-check-label input[type="checkbox"]+.input-helper:after{position: absolute;top: 0;left: 0}.form-check .form-check-label input[type="checkbox"]+.input-helper:after{-webkit-transition: all;-moz-transition: all;-ms-transition: all;-o-transition: all;transition: all;transition-duration: 0s;-webkit-transition-duration: 250ms;transition-duration: 250ms;font-family: Material Design Icons;opacity: 0;filter: alpha(opacity=0);-webkit-transform: scale(0);-ms-transform: scale(0);-o-transform: scale(0);transform: scale(0);content: '\F12C';font-size: .9375rem;font-weight: bold;color: #ffffff}.form-check .form-check-label input[type="checkbox"]+.input-helper:before, .form-check .form-check-label input[type="checkbox"]+.input-helper:after{position: absolute;top: 0;left: 0}.form-check .form-check-label input[type="checkbox"]:checked+.input-helper:before{background: #891731;border-width: 0}.form-check .form-check-label input[type="checkbox"]+.input-helper:before{content: "";width: 18px;height: 18px;border-radius: 2px;border: solid #891731;border-width: 2px;-webkit-transition: all;-moz-transition: all;-ms-transition: all;-o-transition: all;transition: all;transition-duration: 0s;-webkit-transition-duration: 250ms;transition-duration: 250ms}.form-check .form-check-label input[type="checkbox"]+.input-helper:after{font-family: FontAwesome;content: "\f095";display: inline-block;padding-right: 3px;vertical-align: middle;color: #fff}.text-primary, .list-wrapper .completed .remove{color: white !important}.list-wrapper .remove{cursor: pointer;font-size: 1.438rem;font-weight: 600;width: 1.25rem;height: 1.25rem;line-height: 20px;text-align: center}.ml-auto, .list-wrapper .remove, .mx-auto{margin-left: auto !important}.mdi-close-circle-outline:before{content: "\F15A"}.list-wrapper ul li{font-size: .9375rem;padding: .4rem 0;border-bottom: 1px solid #f3f3f3}.mdi:before{font-family: FontAwesome;content: "\f00d";display: inline-block;padding-right: 3px;vertical-align: middle;font-size: .756em;color: white}.list-wrapper ul{padding: 0;text-align: left;list-style: none;margin-bottom: 0}.flex-column-reverse{flex-direction: column-reverse !important}.d-flex, .loader-demo-box, .distribution-chart-legend .distribution-chart, .distribution-chart-legend .distribution-chart .item, .list-wrapper ul li, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a, .email-wrapper .mail-sidebar .menu-bar .profile-list-item a .user, .email-wrapper .mail-list-container .mail-list .details, .email-wrapper .message-body .attachments-sections ul li .thumb, .email-wrapper .message-body .attachments-sections ul li .details .buttons, .lightGallery .image-tile .demo-gallery-poster, .swal2-modal, .navbar .navbar-menu-wrapper .navbar-nav, .navbar .navbar-menu-wrapper .navbar-nav .nav-item.nav-profile, .navbar .navbar-menu-wrapper .navbar-nav .nav-item.dropdown .navbar-dropdown .dropdown-item{display: flex !important}
    button:hover{background-color:#891731 !important;}
    .center {
  margin-top: 40px;
}
.input-group {
    width: 30%;
    padding: 15px;
    float: right;
    margin-right: 3%;
}
.txtCenter{
  text-align: center;
}
.logo-image{
    width: 150px;
    height: auto;
    /* border-radius: 50%; */
    overflow: hidden;
    margin-top: -6px;
}
.swal2-icon.swal2-success {
    border-color: #891731;
    color: #891731;
}
.swal2-icon.swal2-success [class^=swal2-success-line] {
    background-color: #891731;
}
.swal2-success-ring{
  border-color: #891731 !important;
}
.swal2-styled.swal2-confirm {
    background-color: #891731;
  border-color: #891731;
}
.swal2-icon.swal2-warning {
    border-color: #891731;
    color: #891731;
}
  </style>
  <body id="<%= userId%>" onbeforeunload="alert('User is closing my website');">
    <div class="page-content page-container" id="page-content">
        <div class="padding" style="padding-top: 0px;">
          <h2 class="center txtCenter">To-Do List</h2>

          <!-- search -->
            <div class="input-group" id="search">
               <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="searchInput">
               <button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick=searchTask() style="color: white; border-color: white;">Search</button>
            </div>


            <div class="row container d-flex justify-content-center">
                <div class="col-md-12">
                    <div class="card px-3" style="background-color: #5c5c60;">
                        <div class="card-body">
                            <h4 class="card-title"></h4>
                            <div class="add-items d-flex"> <input type="text" class="form-control todo-list-input"  placeholder="What do you need to do today?" style="color:white;"> <button class="add btn btn-primary font-weight-bold todo-list-add-btn" id="addBTN" style="background-color: #891731; border-color:#891731;">Add</button> </div>
                            <div class="list-wrapper" id="uli">
                                <ul class="d-flex flex-column-reverse todo-list" id="ul">
                                    <%= console.log(tasks) %>
                                    <% tasks.forEach((task)=>{%>
                                      <% if(task["taskStatus"]=="todo") {%>
                                        <li id="<%= task.id%>">
                                            <div class="form-check"> <label class="form-check-label"> <input class="checkbox" type="checkbox"> <%= task["taskName"] %> <i class="input-helper"></i></label> </div> <i id="<%= task.id%>"   class="remove mdi mdi-close-circle-outline"></i>
                                        </li>
                                      
                                      <% } else {%>
                                        <li class="completed" id="<%= task.id%>">
                                          <div class="form-check"> <label class="form-check-label"> <input class="checkbox" type="checkbox" checked=""> <%= task["taskName"] %> <i class="input-helper"></i></label> </div> <i id="<%= task.id%>" class="remove mdi mdi-close-circle-outline"></i>
                                      </li>
                                      <% } %>
                                    <% }) %> 
                                </ul>
                            </div>
                            <button id="saveChangesBtn" class="btn btn-primary font-weight-bold todo-list-add-btn"  style="background-color: #891731; border-color:#891731;">Save changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.rtlcss.com/bootstrap/v4.5.3/js/bootstrap.bundle.min.js" integrity="sha384-40ix5a3dj6/qaC7tfz0Yr+p9fqWLzzAXiwxVLt9dw7UjQzGYw6rWRhFAnRapuQyK" crossorigin="anonymous"></script>

    <!-- sweetalert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.1/dist/sweetalert2.all.min.js"></script>
    <script >

      //add task
        (function($) {
    'use strict';
    $(function() {
      var todoListItem = $('.todo-list');
      var todoListInput = $('.todo-list-input');
      var currentUserId=window.location.href.split("/").pop();
      $('.todo-list-add-btn').on("click",async function(event) {
        event.preventDefault();
  
        var item = $(this).prevAll('.todo-list-input').val();
  
        if (item) {
          await fetch(`http://localhost:3000/task/addTask/${item}/${currentUserId}`)
          .then(res=>{
            console.log(res.text());
            todoListItem.append("<li><div class='form-check'><label class='form-check-label'><input class='checkbox' type='checkbox'/>" + item + "<i class='input-helper'></i></label></div><i class='remove mdi mdi-close-circle-outline'></i></li>");
            todoListInput.val("");
          })   
        }
      });
  
      todoListItem.on('change', '.checkbox', function() {
        if ($(this).attr('checked')) {
          $(this).removeAttr('checked');
        } else {
          $(this).attr('checked', 'checked');
        }
  
        $(this).closest("li").toggleClass('completed');
  
      });
  
      //delete task
      todoListItem.on('click', '.remove',async function() {
        await fetch(`http://localhost:3000/task/deleteTask/${event.target.id}`)
        .then(res=>{
          $(this).parent().remove();
        })
      });
  
    });
  })(jQuery);
  
// search 
  function searchTask(tasks){
    var searchInput=document.getElementById("searchInput");
    var tasksLst=document.getElementById("uli").getElementsByTagName("label");
    var res=[];
    for(var i=0;i<tasksLst.length;i++){
      if(tasksLst[i].textContent.includes(searchInput.value)){
        res.push(tasksLst[i].parentElement.closest('li'));
      }
    }
    //remove all the elements that not match to search:
    for(var i=tasksLst.length-1; i>=0;i--){
        tasksLst[i].parentElement.parentElement.remove();
      }
      
    if(res.length>0){
    var ul=document.createElement("ul");
    res.forEach(li=>{
      ul.appendChild(li);
    });
    document.getElementById("uli").appendChild(ul);
  }
  else{    
    document.getElementById("search").insertAdjacentHTML("beforebegin",'no result for: '+ searchInput.value);
  }
  }


//save changes- todo list status
  document.getElementById("saveChangesBtn").addEventListener('click',async function(){

  // async function saveChanges(){
    var tasksLst=document.getElementById("uli").getElementsByTagName("li");
    var currentTasks=[];
    var userId=window.location.href.split("/").pop();
    console.log(userId)
        Array.from(tasksLst).forEach(task=>{
          if(task.classList.contains("completed"))
            currentTasks.push({"task":{"id":task.id,
            "taskName":task.getElementsByTagName("label")[0].textContent,
            "status":"completed",
            "userId":userId}})
            else
            currentTasks.push({"task":{"id":task.id,
            "taskName":task.getElementsByTagName("label")[0].textContent,
            "status":"todo",
            "userId":userId}})
        });
        const response=await fetch("http://localhost:3000/task/updateTask", {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body:JSON.stringify({ 
          tasksLst: currentTasks
          })
        });
        
        response.text().then(data=>{
          if(data=="update"){
            console.log("updateeeee")
            // document.getElementById("saveChangesBtn").addEventListener('click',function(){
             Swal.fire("Tasks Update", "Your to-do list tasks have been successfully updated!", "success")
          //  })
          }
          else{
            Swal.fire("No permissions", "This user is not registered","warning")
          }
        })
    });

  
    
    </script>


  </body>
</html>
















   